<ng-template #carregando>
  <pa-loader titulo="Carregando página" conteudo="Essa operação pode levar até 1 minuto." />
</ng-template>

<ng-container *ngIf="!loading; else carregando">
  <div id="lista_curso_container" class="container">
    <h3>Cursos</h3>

    <div class="card mt-8">
      <p-fluid>
        <div class="grid gap-4 sm:grid-cols-2">
          <div>
            <p-iconfield iconPosition="left" class="ml-auto">
              <p-inputicon><i class="pi pi-search" style="font-size: 0.875rem"></i></p-inputicon>
              <input
                #pesquisaPorNome
                pInputText
                type="text"
                placeholder="Pesquisar por nome"
                pSize="small"
                class="max-w-full"
                (keyup)="pesquisarPorNome($event)"
              />
            </p-iconfield>
          </div>

          <p-button
            class="justify-self-end"
            label="Adicionar Curso"
            icon="pi pi-plus"
            [fluid]="false"
            size="small"
            (click)="adicionarCurso()"
          />
        </div>
      </p-fluid>
    </div>

    <div class="card my-2">
      <p-table
        class="text-sm"
        [value]="cursos"
        [scrollable]="true"
        [paginator]="true"
        [rows]="registrosPorPagina"
        [first]="indicePrimeiroRegistro"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="{first} a {last} de {totalRecords} resultado(s)"
        [tableStyle]="{ 'min-width': '560px' }"
        (onPage)="aoMudarDePagina($event)"
      >
        <ng-template #header>
          <tr>
            <th pSortableColumn="id" style="width: 6.5rem">Código<p-sortIcon field="id" /></th>
            <th pSortableColumn="nome">Nome<p-sortIcon field="nome" /></th>
            <th style="width: 6.5rem">Ações</th>
          </tr>
        </ng-template>
        <ng-template #body let-curso>
          <tr>
            <td>{{ curso.id }}</td>
            <td>{{ curso.nome }}</td>
            <td class="flex justify-between">
              <p-button
                icon="pi pi-pencil"
                size="small"
                [rounded]="true"
                [outlined]="true"
                severity="primary"
                (click)="atualizarCurso(curso)"
              ></p-button>

              <p-button
                icon="pi pi-trash"
                size="small"
                [rounded]="true"
                [outlined]="true"
                severity="primary"
                (click)="confirmarExclusao(curso)"
              ></p-button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <pa-dialog
    id="lista_curso_dialog_erro"
    [mostrarDialog]="mostrarDialog"
    [tituloErro]="tituloErro"
    [mensagemErro]="mensagemErro"
  ></pa-dialog>

  <p-confirmdialog [style]="{ width: '20rem' }">
    <ng-template #headless let-message let-onAccept="onAccept" let-onReject="onReject">
      <div class="flex flex-col p-4">
        <h5 class="mt-0 text-zinc-800">{{ message.header }}</h5>
        <p class="mt-4 mb-5 text-sm">{{ message.message }}</p>
        <div class="flex justify-end gap-2">
          <p-button label="Sim" (onClick)="onAccept()" size="small" styleClass="w-20"></p-button>
          <p-button label="Não" [outlined]="true" (onClick)="onReject()" size="small" styleClass="w-20"></p-button>
        </div>
      </div>
    </ng-template>
  </p-confirmdialog>
</ng-container>
